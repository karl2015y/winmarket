var K=Object.defineProperty;var B=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var R=(i,a,u)=>a in i?K(i,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[a]=u,M=(i,a)=>{for(var u in a||(a={}))Q.call(a,u)&&R(i,u,a[u]);if(B)for(var u of B(a))W.call(a,u)&&R(i,u,a[u]);return i};import{a3 as A,D as x,h as F,R as L,v as n,n as p,o as r,G as b,a4 as O,F as H,A as X,a0 as $,ad as ee,ae as te,az as ae,ak as oe,al as le,m as ne,a2 as se,w as _,x as J,Y as T,s as m,$ as g,Z as D,aa as de,aB as re}from"./vendor.2577d0b7.js";/* empty css                        *//* empty css               *//* empty css                   *//* empty css                  *//* empty css                        *//* empty css                  */import{_ as G,s as I,g as ie,c as ue,d as ce,f as pe}from"./index.827d2c96.js";import{e as _e,a as me,b as ve}from"./editorImg.42d2ecce.js";import{d as ge}from"./vuedraggable.umd.799fb6e0.js";const fe={components:{editorText:_e,editorTextarea:me,editorImg:ve,draggable:ge},props:["modelValue"],setup(i,a){const u=A(),e=x(u.params.product_id),o=x(JSON.parse(JSON.stringify(i.modelValue))),y=()=>{if(o.value.image_url.length>0&&o.value.image_url[0]===0)return alert("\u8ACB\u5148\u5C07\u5716\u7247\u4E0A\u50B3\u5B8C\u5F8C\u518D\u65B0\u589E\uFF01"),!1;o.value.image_url.unshift(0)},d=()=>{const f=o.value.id;I(["products",e.value,"spec"],o.value).then(()=>{o.value=M({id:f},o.value),a.emit("update:modelValue",JSON.parse(JSON.stringify(o.value))),alert("\u66F4\u65B0\u6210\u529F")})},k=F(()=>JSON.stringify(i.modelValue)==JSON.stringify(o.value));return L(()=>{}),{mvalue:o,updateDataHandler:d,addProductImage:y,savedStatus:k}}},he={key:0,class:"py-1 px-3"},ye={class:"border border-solid m-3 p-2 shadow"},xe={class:"p-1.5"},be=r("h2",{class:"mb-2"},"\u54C1\u9805\u540D\u7A31",-1),ke={class:"p-1.5"},we=r("h2",{class:"mb-2"},"\u54C1\u9805\u6578\u91CF",-1),Ve={class:"p-1.5"},He=r("h2",{class:"mb-2"},"\u54C1\u9805\u50F9\u9322(\u539F\u59CB)",-1),De={class:"p-1.5"},Oe=r("h2",{class:"mb-2"},"\u54C1\u9805\u50F9\u9322(\u92B7\u552E)",-1),Ce={class:"p-1.5"},Se=r("h2",{class:"inline"},"\u5546\u54C1\u5716\u7247 600x600",-1);function Ne(i,a,u,e,o,y){return n(),p(H,null,[e.savedStatus?(n(),p("span",he," \u5DF2\u5132\u5B58 ")):(n(),p("button",{key:1,onClick:a[0]||(a[0]=d=>e.updateDataHandler()),class:"ml-4 inline-flex text-white bg-skin-500 border-0 py-1 px-3 focus:outline-none hover:bg-skin-600 rounded"}," \u5132\u5B58 ")),r("div",ye,[r("div",xe,[be,(n(),b(O("editor-text"),{modelValue:e.mvalue.name,"onUpdate:modelValue":a[1]||(a[1]=d=>e.mvalue.name=d),updateDataHandler:e.updateDataHandler,option:""},null,8,["modelValue","updateDataHandler"]))]),r("div",ke,[we,(n(),b(O("editor-text"),{modelValue:e.mvalue.count,"onUpdate:modelValue":a[2]||(a[2]=d=>e.mvalue.count=d),updateDataHandler:e.updateDataHandler,option:""},null,8,["modelValue","updateDataHandler"]))]),r("div",Ve,[He,(n(),b(O("editor-text"),{modelValue:e.mvalue.origin_price,"onUpdate:modelValue":a[3]||(a[3]=d=>e.mvalue.origin_price=d),updateDataHandler:e.updateDataHandler,option:""},null,8,["modelValue","updateDataHandler"]))]),r("div",De,[Oe,(n(),b(O("editor-text"),{modelValue:e.mvalue.price,"onUpdate:modelValue":a[4]||(a[4]=d=>e.mvalue.price=d),updateDataHandler:e.updateDataHandler,option:""},null,8,["modelValue","updateDataHandler"]))]),r("div",Ce,[Se,(n(),b(O("editor-img"),{modelValue:e.mvalue.image_url,"onUpdate:modelValue":a[5]||(a[5]=d=>e.mvalue.image_url=d),updateDataHandler:e.updateDataHandler,option:"600x600"},null,8,["modelValue","updateDataHandler"]))])])],64)}var Je=G(fe,[["render",Ne]]);const je={name:"productPage",components:{editProductSpec:Je},setup(){const i=A(),a=X(),u=()=>{if(i.params&&i.params.product_id)return e.value=i.params.product_id,!0;alert("\u53C3\u6578\u932F\u8AA4\uFF0C\u6C92\u6709\u5546\u54C1id"),a.back()},e=x(""),o=x({}),y=x(""),d=()=>{ie([`products/${e.value}`]).then(l=>{l.id||(alert("\u53C3\u6578\u932F\u8AA4\uFF0C\u6C92\u6709\u5546\u54C1id"),a.back()),o.value=l,y.value=JSON.stringify(l)})},k=l=>{const s=o.value.option;for(let h=0;h<s.length;h++)if(s[h].name==l)return h},f=x({}),j=l=>{const s=k(l);f.value[s]=!f.value[s];const h=o.value.option[s];h&&h.value.length==0&&(alert("\u898F\u683C\u9078\u9805\u8ACB\u52FF\u7A7A\u767D"),f.value[s]=!0)},w=()=>{const l=`\u65B0\u898F\u683C${o.value.option.length+1}`;o.value.option.push({value:[],name:l});const s=k(l);f.value[s]=!0},P=l=>{const s=k(l);f.value[s]=!1,o.value.option[s]?o.value.option.splice(s,1):alert("\u522A\u9664\u932F\u8AA4")},U=F(()=>y.value==JSON.stringify(o.value)),E=()=>{if(!confirm("\u5132\u5B58\u5F8C\uFF0C\u9700\u8981\u66F4\u65B0\u54C1\u9805\u5167\u5BB9\uFF0C\u662F\u5426\u7E7C\u7E8C\uFF1F"))return!1;const l=JSON.parse(JSON.stringify(o.value));I(["products"],l).then(()=>{alert("\u66F4\u65B0\u6210\u529F\uFF01"),y.value=JSON.stringify(o.value),c(),alert("\u5373\u5C07\u5275\u5EFA\u65B0\u7684\u54C1\u9805"),C()})},t=x([]),z=()=>{ue(["products",e.value,"spec"]).then(l=>{t.value=l,t.value.length==0&&C()})},c=()=>{t.value.forEach(l=>{ce(["products",e.value,"spec",l.id])})},C=()=>{if(t.value=[],console.log("product_data",o.value.option.length),o.value.option.length==0)t.value[0]={id:encodeURIComponent(o.value.name),name:o.value.name,count:0,sold_count:0,image_url:"",price:0,origin_price:0};else{let h=function(v,V){for(var S=s.shift(),N=0;N<v.length;N++)S?h(S,V+v[N]+"/"):l.push(V+v[N]);S&&s.push(S)};const s=[];o.value.option.forEach(v=>{s.push(v.value)});var l=[];h(s.shift(),""),l.forEach(v=>{t.value.push({id:encodeURIComponent(v),name:v,count:0,sold_count:0,image_url:"",price:0,origin_price:0})})}pe(["products",e.value,"spec"],t.value)},Y=x(!1),Z=x(-1),q=()=>{if(!t.value||t.value.length<=0)return 0;let l=Number(t.value[0].price),s=Number(t.value[0].price);if(t.value.forEach(v=>{const V=Number(v.price);V>l&&(l=V),V<s&&(s=V)}),o.value.min_price!=s||o.value.max_price!=l){o.value.min_price=s,o.value.max_price=l;const v=JSON.parse(JSON.stringify(o.value));I(["products"],v).then(()=>{y.value=JSON.stringify(o.value)})}};return L(()=>{u()&&(d(),z())}),{product_data:o,product_data_server:y,editing_option:f,editOptionTarget:j,addOptionHandler:w,deleteOptionHandler:P,saved_status:U,updateDataHandler:E,product_spec:t,edit_spec_status:Y,editing_spec_index:Z,getPriceRangeHandler:q}}},Pe={key:0,class:"m-5 border-solid border rounded p-2 shadow"},Ue={class:"flex justify-between"},Ee={class:"flex items-center gap-2"},ze=r("h1",{class:"font-bold text-xl"},"\u5546\u54C1\u898F\u683C\u9078\u9805",-1),Te=r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Ie=[Te],Be=g("\u5DF2\u5132\u5B58"),Re=g("\u5132\u5B58"),Me={key:0,class:"text-center text-gray-400 text-sm"},Ae=g(" | "),Fe=g("\u7DE8\u8F2F"),Le=g("\u522A\u9664"),Ge={key:1,class:"gap-2 my-1"},Ye=["onUpdate:modelValue"],Ze=g(" \uFF1A "),qe=g("\u5B8C\u6210\u7DE8\u8F2F"),Ke=g("\u522A\u9664"),Qe={class:"m-5 border-solid border rounded p-2 shadow"},We=r("h1",{class:"font-bold text-xl"},"\u5546\u54C1\u54C1\u9805",-1),Xe={key:1},$e={key:0},et=g("\u7DE8\u8F2F");function tt(i,a,u,e,o,y){const d=$,k=ee,f=te,j=ae,w=oe,P=le,U=ne("editProductSpec"),E=se;return n(),p(H,null,[e.product_data&&e.product_data.option?(n(),p("div",Pe,[r("div",Ue,[r("div",Ee,[ze,r("button",{class:"text-green-500",onClick:a[0]||(a[0]=(...t)=>e.addOptionHandler&&e.addOptionHandler(...t))},Ie)]),r("div",null,[e.saved_status?(n(),b(d,{key:0,class:"!my-1",size:"small"},{default:_(()=>[Be]),_:1})):(n(),b(d,{key:1,onClick:a[1]||(a[1]=t=>e.updateDataHandler()),class:"!my-1",size:"small",type:"success"},{default:_(()=>[Re]),_:1}))])]),e.product_data.option.length==0?(n(),p("div",Me," \u7121\u5546\u54C1\u898F\u683C\u9078\u9805\u300A\u6B64\u6642\u5546\u54C1\u70BA\u55AE\u4E00\u54C1\u9805\u300B ")):J("",!0),(n(!0),p(H,null,T(e.product_data.option,(t,z)=>(n(),p("div",{class:"lg:text-sm px-2 py-1 hover:shadow hover:bg-gray-50",key:t},[e.editing_option[z]?(n(),p("div",Ge,[de(r("input",{type:"text","onUpdate:modelValue":c=>t.name=c,placeholder:"Please input",class:"w-24 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-xs outline-none text-gray-700 py-0.5 px-1.5 leading-1 transition-colors duration-200 ease-in-out"},null,8,Ye),[[re,t.name]]),Ze,m(f,{modelValue:t.value,"onUpdate:modelValue":c=>t.value=c,multiple:"",filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"\u8ACB\u8F38\u5165\u5546\u54C1\u898F\u683C\u9078\u9805"},{default:_(()=>[(n(!0),p(H,null,T(t.value,c=>(n(),b(k,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),m(d,{class:"!my-1 !ml-2",size:"small",onClick:c=>e.editOptionTarget(t.name)},{default:_(()=>[qe]),_:2},1032,["onClick"]),m(d,{class:"!my-1 !ml-1",size:"small",type:"danger",onClick:c=>e.deleteOptionHandler(t.name)},{default:_(()=>[Ke]),_:2},1032,["onClick"])])):(n(),p(H,{key:0},[g(D(t.name)+"\uFF1A ",1),(n(!0),p(H,null,T(t.value,(c,C)=>(n(),p("span",{key:c},[g(D(c)+" ",1),t.value.length-1!=C?(n(),p(H,{key:0},[Ae],64)):J("",!0)]))),128)),m(d,{class:"!my-1 !ml-2",size:"small",onClick:c=>e.editOptionTarget(t.name)},{default:_(()=>[Fe]),_:2},1032,["onClick"]),m(d,{class:"!my-1 !ml-1",size:"small",type:"danger",onClick:c=>e.deleteOptionHandler(t.name)},{default:_(()=>[Le]),_:2},1032,["onClick"])],64))]))),128))])):J("",!0),r("div",Qe,[We,m(P,{data:e.product_spec,style:{width:"100%"}},{default:_(()=>[m(w,{label:"\u7E2E\u5716",width:"150"},{default:_(t=>[t.row.image_url&&t.row.image_url.length>0?(n(),b(j,{key:0,src:t.row.image_url,style:{width:"100px",height:"100px"}},null,8,["src"])):(n(),p("p",Xe,"\u6C92\u6709\u5716\u7247"))]),_:1}),m(w,{prop:"name",label:"\u54C1\u9805\u540D\u7A31",width:"180"}),m(w,{label:"\u50F9\u9322",width:"230"},{default:_(t=>[r("span",null,[g(D(i.$filters.money(t.row.price))+" ",1),t.row.price!=t.row.origin_price?(n(),p("span",$e,"(\u539F\uFF1A"+D(i.$filters.money(t.row.origin_price))+")",1)):J("",!0)])]),_:1}),m(w,{prop:"count",label:"\u6578\u91CF(\u8CE3\u6578/\u539F\u6578)",width:"180"},{default:_(t=>[g(D(t.row.sold_count)+"/ "+D(t.row.count),1)]),_:1}),m(w,{align:"right"},{default:_(t=>[m(d,{class:"!my-1",size:"small",onClick:()=>{e.editing_spec_index=t.$index,e.edit_spec_status=!0}},{default:_(()=>[et]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),m(E,{modelValue:e.edit_spec_status,"onUpdate:modelValue":a[3]||(a[3]=t=>e.edit_spec_status=t),title:"\u7DE8\u8F2F\u54C1\u9805","destroy-on-close":!0,onClose:a[4]||(a[4]=t=>e.getPriceRangeHandler())},{default:_(()=>[m(U,{modelValue:e.product_spec[e.editing_spec_index],"onUpdate:modelValue":a[2]||(a[2]=t=>e.product_spec[e.editing_spec_index]=t)},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}var _t=G(je,[["render",tt]]);export{_t as default};
