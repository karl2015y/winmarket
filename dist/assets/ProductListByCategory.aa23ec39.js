import{_ as x,a as H}from"./index.4c5df9d9.js";import{Q as y,D as f,U as w,m as b,v as m,H as I,w as g,o as a,s as h,aa as k,n as _,x as p,t as B,a0 as P,$ as v,F as C,Z as F}from"./vendor.2e9f8f3e.js";const S={props:["product"],setup(o){y("mapStore");const e=f(o.product),i=()=>{document.querySelectorAll("img.loading-img").forEach(l=>{l.src})},t=l=>{var r;((r=l.path[0].src)!=null?r:!1)&&l.path[0].classList.remove("loading-img")};w(()=>{i()});const u=f(!0);return{product:e,showFirstImg:u,ImgIsLoaded:t}}},j={class:"relative h-52 md:h-72"},M=["src","alt"],E=["src","alt"],N={class:"card-body"},V={class:"flex items-center flex-col relative"},O={key:0,class:"absolute w-full h-full bg-black bg-opacity-50 flex justify-center items-center"},q=a("button",{class:"text-white bg-skin-500 border-0 py-1 px-2.5 focus:outline-none hover:bg-skin-600 rounded text-xs"}," \u67E5\u770B\u5546\u54C1 ",-1),z=[q],A={class:"my-3 text-center"},D={class:"text-xl sm:text-sm md:text-lg 2xl:text-sm"},Q={class:"mt-2 text-base sm:text-sm 2xl:text-xs font-bold"},T={key:0};function R(o,e,i,t,u,l){const r=b("router-link");return m(),I(r,{to:`/shop/product/${t.product.id}`},{default:g(()=>[a("div",{class:"w-full hover:shadow pb-2 rounded bg-white",onMouseover:e[1]||(e[1]=n=>t.showFirstImg=!1),onMouseleave:e[2]||(e[2]=n=>t.showFirstImg=!0)},[h(r,{class:"card-img",to:`/shop/product/${t.product.id}`},{default:g(()=>[a("div",j,[a("img",{onLoad:e[0]||(e[0]=(...n)=>t.ImgIsLoaded&&t.ImgIsLoaded(...n)),src:t.product.image_url[0],alt:t.product.name,class:k(["loading-img absolute object-contain top-0 left-0 w-full h-full animate__animated",t.showFirstImg||t.product.image_url.length==1?"animate__fadeIn":"animate__fadeOut"])},null,42,M),a("img",{src:t.product.image_url[1],alt:t.product.name,class:k(["absolute object-contain top-0 left-0 w-full h-full animate__animated",t.product.image_url.length>1&&!t.showFirstImg?"animate__fadeIn":"animate__fadeOut"])},null,10,E)])]),_:1},8,["to"]),a("div",N,[a("div",V,[h(B,{"enter-active-class":"animate__animated animate__fadeIn animate__faster","leave-active-class":"animate__animated animate__fadeOut animate__faster"},{default:g(()=>[t.showFirstImg?p("",!0):(m(),_("div",O,z))]),_:1}),a("div",A,[a("div",D,[h(r,{to:`/shop/product/${t.product.id}`},{default:g(()=>[P(v(t.product.name),1)]),_:1},8,["to"])]),a("p",Q,[P(v(o.$filters.money(t.product.min_price))+" ",1),t.product.min_price!=t.product.max_price?(m(),_("span",T,"~ "+v(o.$filters.money(t.product.max_price)),1)):p("",!0)])])])])],32)]),_:1},8,["to"])}var U=x(S,[["render",R]]);const W={props:["product_category","max","product_id","need_more"],components:{ProductCard:U},setup(o){const{chageLoadingStatusHandler:e}=y("mapStore"),i=f([]),t=f(null),u=()=>{e("ProductListByCategory_getProductsHandler",!0),H(["products"],o.product_category?[["category","array-contains-any",o.product_category]]:null,"sort",t.value,o.max).then(s=>{i.value.push(...s.current),t.value=s.next,e("ProductListByCategory_getProductsHandler",!1),o.product_id&&n()})},l=(s,d)=>{let c=s.getBoundingClientRect(),L=window.innerHeight||document.documentElement.clientHeight;return!(Math.floor(100-(c.top>=0?0:c.top)/+-c.height*100)<d||Math.floor(100-(c.bottom-L)/c.height*100)<d)},r=s=>{if(o.need_more){const d=setInterval(()=>{const c=document.querySelector("#more_data");c&&l(c,1)&&u(),t.value===void 0&&clearInterval(d)},300)}},n=()=>{const s=i.value;for(let d=0;d<s.length;d++)if(s[d].id==o.product_id){s.splice(d,1);break}};return w(()=>{u(),r()}),{getProductsHandler:u,product_list:i,next_product_shot:t}}},X={key:0,class:"p-3"};function Z(o,e,i,t,u,l){const r=b("ProductCard");return m(),_(C,null,[(m(!0),_(C,null,F(t.product_list,n=>(m(),I(r,{key:n.id,product:n},null,8,["product"]))),128)),i.need_more&&t.next_product_shot?(m(),_("div",X,[a("button",{id:"more_data",onClick:e[0]||(e[0]=n=>t.getProductsHandler())},"\u8F09\u5165\u4E2D...")])):p("",!0)],64)}var K=x(W,[["render",Z]]);export{U as P,K as a};
